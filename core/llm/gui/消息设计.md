# GUI Agent 消息设计 (Message Design)

GUI Agent 与客户端（UI）之间通过 `Queue` 进行通信，消息格式为 JSON 字典。

## 1. 客户端 -> Agent (Client to Agent)
客户端发送的消息主要用于控制 Agent 的行为。

**基本格式:**
```json
{
  "name": "GUIAgent",
  "type": "request",
  "content": "指令内容"
}
```

**指令内容 (content):**
- `stop_agent`: 停止整个 Agent 任务。

## 2. Agent -> 客户端 (Agent to Client)
Agent 发送的消息用于更新状态、流式传输 AI 回复、以及展示操作意图。

**基本格式:**
```json
{
  "name": "GUIAgent",
  "type": "消息类型",
  "content": "消息内容"
}
```

### 2.1 状态消息 (type: "status")
用于通知 UI 当前 Agent 的工作阶段。
- `[START]`: 任务开始。
- `[STOP]`: 任务结束（完成或被用户停止）。
- `[BEGIN]`: 开始生成 AI 内容。
- `[END]`: AI 内容生成结束。

### 2.2 AI 内容流 (type: "ai_content")
用于流式展示 LLM 的思考和回复过程。
- `<text>`: AI 生成的文本片段（增量更新）。

### 2.3 动作坐标 (type: "action_point")
**[NEW]** 在执行鼠标操作前，发送即将操作的目标坐标，供客户端展示（如绘制点击位置）。

**Content 格式 (JSON Object):**
```json
{
  "x": 100,          // 绝对坐标 X (或者 drag 的 start_x)
  "y": 200,          // 绝对坐标 Y (或者 drag 的 start_y)
  "xx": 300,         // [Optional] drag 的 end_x
  "yy": 400,         // [Optional] drag 的 end_y
  "action": "click"  // 动作类型
}
```
注意：对于 `drag` 操作，发送 `start_point` (x, y) 和 `end_point` (xx, yy)。

### 2.4 截图图片
- `<image/png>`/`<image/jpeg>`: 给客户端发送当前截图图片

## 3. 交互流程示例

1. **任务开始**: Agent 发送 `status: [START]`。
2. **截图**: Agent 获取屏幕截图（不发送给客户端）。
3. **AI 思考**: Agent 发送 `status: [BEGIN]`, 然后流式发送 `ai_content`。
4. **动作解析**: Agent 解析出下一步动作（例如点击 (100, 200)）。
5. **发送坐标**: Agent 发送 `type: action_point, content: {"x": 100, "y": 200, "action": "click"}`。
6. **执行动作**: Agent 执行实际的鼠标点击。
7. **循环**: 回到步骤 2，直到任务结束。
8. **任务结束**: Agent 发送 `status: [STOP]`。
