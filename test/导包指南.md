# PowerShellLanguage å¯¼åŒ…æŒ‡å—
## å¿«é€Ÿå¼€å§‹

### âœ… æ¨èæ–¹æ³•ï¼šæ·»åŠ é¡¹ç›®è·¯å¾„

```python
import sys
import os

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°Pythonè·¯å¾„
project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__)))))
if project_root not in sys.path:
    sys.path.insert(0, project_root)

# ç°åœ¨å¯ä»¥æ­£å¸¸å¯¼å…¥
from core.computer.code.languages.powershell import PowerShellLanguage
```

## ä¸åŒçš„ä½¿ç”¨åœºæ™¯

### 1. åœ¨é¡¹ç›®ä¸­ä½¿ç”¨

å¦‚æœæ‚¨çš„è„šæœ¬åœ¨é¡¹ç›®å†…éƒ¨ï¼š

```python
# åœ¨ agent4/ ç›®å½•ä¸‹çš„ä»»ä½•æ–‡ä»¶ä¸­
from core.computer.code.languages.powershell import PowerShellLanguage

ps = PowerShellLanguage()
if ps.is_available():
    message_queue = ps.run("Get-Date")
    # å¤„ç†è¾“å‡º...
```

### 2. ç‹¬ç«‹æµ‹è¯•è„šæœ¬

```python
#!/usr/bin/env python3
import sys
import os

# è·å–é¡¹ç›®æ ¹ç›®å½•
current_dir = os.path.dirname(os.path.abspath(__file__))
while current_dir != os.path.dirname(current_dir):
    parent = os.path.dirname(current_dir)
    if os.path.basename(parent) == 'agent4':
        project_root = parent
        break
    current_dir = parent
else:
    project_root = os.path.dirname(os.path.abspath(__file__))

sys.path.insert(0, project_root)

from core.computer.code.languages.powershell import PowerShellLanguage
```

### 3. ä¸´æ—¶æµ‹è¯•

```python
# ä¸´æ—¶å¿«é€Ÿæµ‹è¯•
import sys
sys.path.append('d:/agent4')

from core.computer.code.languages.powershell import PowerShellLanguage
```

## å¸¸è§é—®é¢˜è§£å†³

### âŒ é—®é¢˜1: ImportError: attempted relative import with no known parent package

**åŸå› **: å°è¯•åœ¨éåŒ…ç¯å¢ƒä¸­ä½¿ç”¨ç›¸å¯¹å¯¼å…¥

**è§£å†³**: ä½¿ç”¨ç»å¯¹å¯¼å…¥æˆ–æ·»åŠ åˆ°Pythonè·¯å¾„

```python
# é”™è¯¯
from ..base_language import BaseLanguage  # åœ¨ç‹¬ç«‹è„šæœ¬ä¸­ä¼šå¤±è´¥

# æ­£ç¡®
from core.computer.code.base_language import BaseLanguage
```

### âŒ é—®é¢˜2: ModuleNotFoundError: No module named 'core'

**åŸå› **: Pythonæ‰¾ä¸åˆ°é¡¹ç›®æ¨¡å—

**è§£å†³**: æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°è·¯å¾„

```python
import sys
import os

# æ–¹æ³•1: åŠ¨æ€æ·»åŠ 
sys.path.insert(0, 'd:/agent4')

# æ–¹æ³•2: è‡ªåŠ¨æ£€æµ‹é¡¹ç›®æ ¹
def find_project_root():
    current = os.path.dirname(os.path.abspath(__file__))
    while current != os.path.dirname(current):
        parent = os.path.dirname(current)
        if os.path.basename(parent) == 'agent4':
            return parent
        current = parent
    return os.path.dirname(os.path.abspath(__file__))

sys.path.insert(0, find_project_root())
```

## é¡¹ç›®ç»“æ„è¦æ±‚

ç¡®ä¿ä»¥ä¸‹ç›®å½•ç»“æ„ä¸­æœ‰ `__init__.py` æ–‡ä»¶ï¼š

```
agent4/
â”œâ”€â”€ __init__..py          # âœ… å·²åˆ›å»º
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ __init__.py      # âœ… å·²å­˜åœ¨
â”‚   â””â”€â”€ computer/
â”‚       â”œâ”€â”€ __init__.py  # âœ… å·²åˆ›å»º
â”‚       â””â”€â”€ code/
â”‚           â”œâ”€â”€ __init__.py  # âœ… å·²åˆ›å»º
â”‚           â”œâ”€â”€ base_language.py
â”‚           â””â”€â”€ languages/
â”‚               â”œâ”€â”€ __init__.py  # âœ… å·²åˆ›å»º
â”‚               â””â”€â”€ powershell.py
```

## æœ€ä½³å®è·µ

### 1. åˆ›å»ºé…ç½®æ–‡ä»¶

åˆ›å»º `config.py` æ¥ç»Ÿä¸€ç®¡ç†å¯¼å…¥ï¼š

```python
# config.py
import sys
import os

def setup_project_path():
    """è®¾ç½®é¡¹ç›®è·¯å¾„"""
    current_dir = os.path.dirname(os.path.abspath(__file__))
    while current_dir != os.path.dirname(current_dir):
        parent = os.path.dirname(current_dir)
        if os.path.basename(parent) == 'agent4':
            project_root = parent
            break
        current_dir = parent
    else:
        project_root = current_dir
    
    if project_root not in sys.path:
        sys.path.insert(0, project_root)
    
    return project_root

# åœ¨å…¶ä»–æ–‡ä»¶ä¸­ä½¿ç”¨
import config
config.setup_project_path()
from core.computer.code.languages.powershell import PowerShellLanguage
```

### 2. ä½¿ç”¨ç¯å¢ƒå˜é‡

```python
import os
import sys

# è®¾ç½®ç¯å¢ƒå˜é‡
os.environ['AGENT4_ROOT'] = 'd:/agent4'
sys.path.insert(0, os.environ['AGENT4_ROOT'])
```

### 3. åˆ›å»ºåŒ…è£…å‡½æ•°

```python
def get_powershell_language():
    """è·å–PowerShellLanguageå®ä¾‹çš„åŒ…è£…å‡½æ•°"""
    import sys
    import os
    
    # ç¡®ä¿è·¯å¾„è®¾ç½®æ­£ç¡®
    project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__)))))
    if project_root not in sys.path:
        sys.path.insert(0, project_root)
    
    from core.computer.code.languages.powershell import PowerShellLanguage
    return PowerShellLanguage()

# ä½¿ç”¨
ps = get_powershell_language()
```

## å®Œæ•´ç¤ºä¾‹

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
å®Œæ•´çš„PowerShellLanguageä½¿ç”¨ç¤ºä¾‹
"""

import sys
import os
import time

def setup_import():
    """è®¾ç½®å¯¼å…¥ç¯å¢ƒ"""
    # æŸ¥æ‰¾é¡¹ç›®æ ¹ç›®å½•
    current_dir = os.path.dirname(os.path.abspath(__file__))
    while current_dir != os.path.dirname(current_dir):
        parent = os.path.dirname(current_dir)
        if os.path.basename(parent) == 'agent4':
            project_root = parent
            break
        current_dir = parent
    else:
        project_root = current_dir
    
    # æ·»åŠ åˆ°Pythonè·¯å¾„
    if project_root not in sys.path:
        sys.path.insert(0, project_root)
    
    return project_root

def main():
    """ä¸»å‡½æ•°"""
    # è®¾ç½®å¯¼å…¥ç¯å¢ƒ
    project_root = setup_import()
    print(f"é¡¹ç›®æ ¹ç›®å½•: {project_root}")
    
    try:
        # å¯¼å…¥PowerShellLanguage
        from core.computer.code.languages.powershell import PowerShellLanguage
        print("âœ… æˆåŠŸå¯¼å…¥ PowerShellLanguage")
        
        # åˆ›å»ºå®ä¾‹
        ps = PowerShellLanguage()
        
        # æ£€æŸ¥å¯ç”¨æ€§
        if not ps.is_available():
            print("âŒ PowerShell ä¸å¯ç”¨")
            return
        
        print("âœ… PowerShell å¯ç”¨")
        
        # æ‰§è¡Œå‘½ä»¤
        code = '''
        Write-Host "=== PowerShell æµ‹è¯• ==="
        Write-Host "å½“å‰æ—¶é—´: $(Get-Date)"
        Write-Host "å½“å‰ç›®å½•: $(Get-Location)"
        Write-Host "=== æµ‹è¯•å®Œæˆ ==="
        '''
        
        print("\næ‰§è¡ŒPowerShellå‘½ä»¤...")
        message_queue = ps.run(code)
        
        # è¯»å–è¾“å‡º
        output_lines = []
        while ps.is_running or not message_queue.empty():
            try:
                if not message_queue.empty():
                    message = message_queue.get_nowait()
                    content = message['content'].rstrip()
                    if content:
                        output_lines.append(content)
                        print(f"ğŸ“¤ {content}")
                else:
                    time.sleep(0.1)
            except:
                break
        
        print(f"\nâœ… æ‰§è¡Œå®Œæˆï¼Œå…±è¾“å‡º {len(output_lines)} è¡Œ")
        
    except ImportError as e:
        print(f"âŒ å¯¼å…¥å¤±è´¥: {e}")
    except Exception as e:
        print(f"âŒ æ‰§è¡Œå¤±è´¥: {e}")

if __name__ == "__main__":
    main()
```

## æ€»ç»“

1. **æ¨èä½¿ç”¨é¡¹ç›®è·¯å¾„æ–¹æ³•**ï¼Œé€‚ç”¨äºå¤§å¤šæ•°åœºæ™¯
2. **ç¡®ä¿ `__init__.py` æ–‡ä»¶å­˜åœ¨**ï¼Œè®©Pythonè¯†åˆ«ä¸ºåŒ…
3. **ä½¿ç”¨ç»å¯¹å¯¼å…¥**è€Œéç›¸å¯¹å¯¼å…¥ï¼Œé¿å…è·¯å¾„é—®é¢˜
4. **æµ‹è¯•æ—¶å¯ä»¥ä½¿ç”¨ä¸´æ—¶è·¯å¾„æ·»åŠ **ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨é…ç½®ç®¡ç†

è®°ä½ï¼š`sys.path.insert(0, project_root)` æ˜¯è§£å†³å¯¼å…¥é—®é¢˜çš„æœ€ç®€å•æœ‰æ•ˆçš„æ–¹æ³•ï¼
